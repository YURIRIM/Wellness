<!--
오른쪽 사이드바 - 모든 태그의 id는 `right-`로 시작
-->
<th:block th:fragment="chalMain-right">
  <!--
*중요 - 모든 태그의 id는 `right-`로 시작하기(다른 조각과 충돌 방지)
css사용 시, class가 아닌 id로 연결하기
스크립트 사용 시, thymeleaf를 사용해야 할 경우 해당 변수는 별도로 선언하기
부트스트랩(+아이콘,달력), axios, jquery 라이브러리는 선언되어 있다고 가정 

사이드바 맨 위는 로그인 본인 프로필

프로필 객체 :
public class Profile {
	private int userNo;
	private byte[] picture;
	private String pictureBase64; //프론트와 base64로 소통
	private String bio;
	private String isOpen;
	
	//challenge_participation
	private int chalParticiapteCount;
	private int successCount;
	private int failCount;
	private Double successRatio;
	private Double failRatio;
}

이 조각이 활성화되면, 먼저 jwt토큰이 있는지 확인.
토큰이 있으면 key : userNo와
model의 loginUser.userNo가 동일한지 확인
동일할 경우, jwt에 담긴 값을 사용
jwt생성 구문은 다음과 같음.
return Jwts.builder()
	.setSubject(String.valueOf(userProfile.getUserNo())) //Subject - 토큰 대상
	.setIssuedAt(now) //발급된 때
	.setExpiration(expiryDate) //만료될 때
	.signWith(getSignKey()) //생성된 암호화 키로 토큰에 디지털 서명(토큰 위조 검증)
	.claim("userNo", userProfile.getUserNo()) //추가적으로 토큰에 담을 데이터
	.claim("bio", userProfile.getBio())
	.claim("pictureBase64", userProfile.getPictureBase64())
	.claim("isOpen", userProfile.getIsOpen())
	.claim("chalParticiapteCount", userProfile.getChalParticiapteCount())
	.claim("successCount", userProfile.getSuccessCount())
	.claim("failCount", userProfile.getFailCount())
	.claim("successRatio", userProfile.getSuccessRatio())
	.claim("failRatio", userProfile.getFailRatio())
	.compact(); //최종적으로 JWT문자열 형태로 압축해 반환해주는 메소드

동일하지 않거나 jwt토큰이 없을 경우, contextPath+'/profile/selectMyProfile'로 post요청
다음은 해당 요청 경로의 컨트롤러
	@PostMapping("/selectMyProfile")
	@ResponseBody
	public ResponseEntity<Map<String, Object>> selectMyProfile(HttpSession session) {
		Map<String, Object> response = new HashMap<>();
	    try {
	        String result = service.selectMyProfile(session);
	        switch (result) {
	            case "0": //오류
	                response.put("status", "false");
	                return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
	            case "2": //로그인 안됨
	                response.put("status", "noUser");
	                return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(response);
	            case "3": //프로필 없음
	                response.put("status", "noProfile");
	                return ResponseEntity.status(HttpStatus.NOT_FOUND).body(response);
	            default: //프로필 jwt로 반환
	                response.put("status", "success");
	                response.put("data", result);
	                return ResponseEntity.ok(response);
	        }
	    } catch (Exception e) {
	        e.printStackTrace();
	        response.put("status", "false");
	        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
	    }
	}
응답이 '오류','로그인 안됨'일 경우 프로필 영역 랜더링 하지 않음
응답이 '프로필 없음'일 경우 '프로필 생성하기' 버튼을 두고,
  이 버튼을 누르면 contextPath+'/profile/insertMyProfile'로 이동하기
응답이 '프로필 jwt로 반환'인 경우, jwt토큰에 있는 값 사용하기

프로필 영역 가이드
--------------
pictureBase64(프로필 사진 - 원형으로 된 작은 액자에 담아 출력하기. 
	base64로 인코딩된 바이너리 데이터가 저장되어 있음.
	만일 해당 key가 존재하지 않을 경우, 로컬 저장소에 challengeWriterImage라는 storageKey로 저장된
	이미지를 대신 사용. 해당 로컬 스토리지에 사진이 없을 경우, 콘솔에 'challengeWriterImage 접근 불가' 라고 표시
) / loginUser.name (이름 - model에 loginUser라는 이름으로 들어있는 name요소)
bio(자기소개 - 최대 100자까지 서버에서 응답받음을 감안해서 영역 설정하기)
챌린지 참여 상황 - 가로 막대 다이어그램 표로 현재 참여 챌린지 현황 표시하기
	파란색의 successRatio(성공률 - 소수점 두 자리까지의 백분율),
	초록색의 100-successRatio-failRatio(진행 중인 비율),
	빨간색의 failRatio(실패율) 순으로 나타내기.
	각 비율 영역에 호버링 이벤트(successCount, chalParticiapteCount, failCount 표시)
isOpen (프로필 공개 여부 - Y:공개, N:참여한 챌린지 비공개, A:익명)
프로필 갱신하기 - contextPath+'/profile/updateMyProfile'로 이동
--------------
위 순서대로 표시

-->
  <div id="right-profile-area" class="mb-4">
    <!-- 프로필 영역 -->
  </div>
  <div id="right-chal-right" class="p-3">
    <div class="list-group">
      <a
        th:href="@{/challenge/newChal}"
        id="right-newChal"
        class="list-group-item list-group-item-action"
        >새로운 챌린지 생성하기</a
      >
      <a
        th:href="@{/challenge/goMyChal?searchType=O}"
        id="right-createdChal"
        class="list-group-item list-group-item-action"
        >내가 생성한 챌린지</a
      >
      <a
        th:href="@{/challenge/goMyChal?searchType=J}"
        id="right-joinedChal"
        class="list-group-item list-group-item-action"
        >내가 참여한 챌린지</a
      >
    </div>
  </div>
</th:block>
