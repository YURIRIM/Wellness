<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="goalMapper">
		
  <!-- resultMap -->
  <resultMap id="goalResultMap" type="Goal">
    <id property="goalNo" column="GOAL_NO" />
    <result property="userNo" column="USER_NO" />
    <result property="title" column="TITLE" />
    <result property="content" column="CONTENT" />
    <result property="startDate" column="START_DATE" />
    <result property="endDate" column="END_DATE" />
    <result property="status" column="STATUS" />
    <result property="goalCategory" column="GOAL_CATEGORY" />
    <result property="whyGoal" column="WHY_GOAL" />
    <result property="action" column="ACTION" />
    <result property="beforeState" column="BEFORE_STATE" />
    <result property="afterState" column="AFTER_STATE" />
    <result property="unit" column="UNIT" />
    <result property="deadlineType" column="DEADLINE_TYPE" />
    <result property="deadlineValue" column="DEADLINE_VALUE" />
    <result property="deadlineUnit" column="DEADLINE_UNIT" />
  </resultMap>
  

<select id="selectGoalsByUser" parameterType="int" resultMap="goalResultMap">
  SELECT 
      *
  FROM GOAL
  WHERE USER_NO = #{userNo}
  ORDER BY START_DATE DESC
</select>


  <!-- insert -->
  <insert id="insertGoal" parameterType="Goal" useGeneratedKeys="false">
  <selectKey keyProperty="goalNo" order="BEFORE" resultType="int">
    SELECT GOAL_NO_SEQ.NEXTVAL FROM DUAL
  </selectKey>
    INSERT INTO GOAL (
      GOAL_NO, USER_NO, TITLE, CONTENT, START_DATE, END_DATE, STATUS,
      GOAL_CATEGORY, WHY_GOAL, ACTION, BEFORE_STATE, AFTER_STATE, UNIT,
      DEADLINE_TYPE, DEADLINE_VALUE, DEADLINE_UNIT
    )
    VALUES (
      #{goalNo}, #{userNo},  CONCAT(CONCAT(CONCAT(#{action}, ' '), #{afterState}), #{unit}), #{content}, SYSDATE, #{endDate}, #{status},
      #{goalCategory}, #{whyGoal}, #{action}, #{beforeState}, #{afterState}, #{unit},
      #{deadlineType}, #{deadlineValue}, #{deadlineUnit}
    )
  </insert>
  
  
  


</mapper>
